!function(e){"use strict";!function(){var t=function(){};"name"in t&&"test"==t.name||Object.defineProperty(Function.prototype,"name",{get:function(){var e;return"__name"in this||(e=this.toString(),this.__name=e.substring(e.indexOf("function")+8,e.indexOf("(")).trim()||void 0),this.__name}}),"requestAnimationFrame"in e||(e.requestAnimationFrame=e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame);var r;"performance"in e||(e.performance={}),"now"in Date||(Date.now=function(){return+new Date}),"now"in e.performance||(r=Date.now(),e.performance.timing&&e.performance.timing.navigationStart&&(r=e.performance.timing.navigationStart),e.performance.now=function(){return Date.now()-r})}();var t,r,n,a,i,o,u,s,l,c,h,m,d,f,v,g,p,x,b,S,F,A,E;!function(){var e={};t=function(t,r){a.value=r,Object.defineProperty(e,t,a)},r=function(t){return 2==arguments.length?e[t][arguments[1]]:e[t]}}(),n={value:!0,writable:!0},a={value:null},i=function(e,t){var r=3==arguments.length?arguments[2]:null;return t?function(){var n=e[this];return t in n?n[t]:r}:function(){return this.uuid in e?e[this]:r}},o=function(e,t){return t?function(r){e[this][t]=r}:function(t){e[this]=t}},u=function(){var e=[];return function(t){return"string"==typeof t&&"#"==t.charAt(0)?(4==t.length&&(t=t.substr(1,3),t="#"+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,t.length>7?(e[3]=parseFloat(t.substr(7)),e[3]>1&&(e[3]=1)):e[3]=1):"r"in t?(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]="a"in t?t.a:1):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]="3"in t?t[3]:1),e}}(),l=1e-6,c=Math.sin,h=Math.cos,m=Math.tan,d=Math.atan,f=Math.atan2,v=Math.asin,g=Math.sqrt,p=Math.ceil,x=Math.abs,b=Math.PI,S=.5*b,F=2*b,A=b/180,E=180/b,Object.freeze(s={linear:function(e,t,r){return r*e+t},backIn:function(e,t,r){return r*e*e*(2.70158*e-1.70158)+t},backOut:function(e,t,r){return e-=1,r*(e*e*(2.70158*e+1.70158)+1)+t},backInOut:function(e,t,r){return e*=2,1>e?.5*r*e*e*(3.5949095*e-2.5949095)+t:(e-=2,.5*r*(e*e*(3.70158*e+2.70158)+2)+t)},bounceOut:function(e,t,r){return.363636>e?7.5625*r*e*e+t:.727272>e?(e-=.545454,r*(7.5625*e*e+.75)+t):.90909>e?(e-=.818181,r*(7.5625*e*e+.9375)+t):(e-=.95454,r*(7.5625*e*e+.984375)+t)},sineIn:function(e,t,r){return-r*Math.cos(e*S)+r+t},sineOut:function(e,t,r){return r*Math.sin(e*S)+t},sineInOut:function(e,t,r){return.5*-r*(Math.cos(b*e)-1)+t},circleIn:function(e,t,r){return-r*(Math.sqrt(1-e*e)-1)+t},circleOut:function(e,t,r){return e-=1,r*Math.sqrt(1-e*e)+t},circleInOut:function(e,t,r){return e*=2,1>e?.5*-r*(Math.sqrt(1-e*e)-1)+t:(e-=2,.5*r*(Math.sqrt(1-e*e)+1)+t)},quadraticIn:function(e,t,r){return r*e*e+t},quadraticOut:function(e,t,r){return-r*e*(e-2)+t}});var y=function(){var t=function(e,t,r,n){var a=e.createBuffer();return e.bindBuffer(t,a),e.bufferData(t,r,e.STATIC_DRAW),a.data=r,a.stride=n,a.numItem=r.length/n,e.bindBuffer(t,null),a};return{makeVBO:function(e,r,n,a){var i,o;i=e.gl,o=e.vbo[r],o||(Array.isArray(n)&&(n=new Float32Array(n)),o=t(i,i.ARRAY_BUFFER,n,a),o.name=r,o.type="VBO",e.vbo[r]=o)},makeVNBO:function(e,r,n,a){var i,o;i=e.gl,o=e.vnbo[r],o||(Array.isArray(n)&&(n=new Float32Array(n)),o=t(i,i.ARRAY_BUFFER,n,a),o.name=r,o.type="VNBO",e.vnbo[r]=o)},makeIBO:function(e,r,n,a){var i,o;i=e.gl,o=e.ibo[r],o||(Array.isArray(n)&&(n=new Uint16Array(n)),o=t(i,i.ELEMENT_ARRAY_BUFFER,n,a),o.name=r,o.type="IBO",e.ibo[r]=o)},makeUVBO:function(e,r,n,a){var i,o;i=e.gl,o=e.uvbo[r],o||(Array.isArray(n)&&(n=new Float32Array(n)),o=t(i,i.ARRAY_BUFFER,n,a),o.name=r,o.type="UVBO",e.uvbo[r]=o)},makeProgram:function(e,t,r,n){var a,i,o,u,s,l,c;if(a=e.gl,i=a.createShader(a.VERTEX_SHADER),o=a.createShader(a.FRAGMENT_SHADER),a.shaderSource(i,r.shaderStr),a.compileShader(i),a.shaderSource(o,n.shaderStr),a.compileShader(o),u=a.createProgram(),a.attachShader(u,i),a.attachShader(u,o),a.linkProgram(u),i.name=r.id,o.name=n.id,u.name=t,!a.getProgramParameter(u,a.LINK_STATUS))throw new Error("프로그램 셰이더 초기화 실패");for(a.useProgram(u),c=r.attributes,l=c.length,s=0;l>s;s++)a.bindBuffer(a.ARRAY_BUFFER,e.vbo["null"]),a.enableVertexAttribArray(u[c[s]]=a.getAttribLocation(u,c[s])),a.vertexAttribPointer(u[c[s]],e.vbo["null"].stride,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,null);for(c=r.uniforms,s=c.length;s--;)u[c[s]]=a.getUniformLocation(u,c[s]);for(c=n.uniforms,s=c.length;s--;)u[c[s]]=a.getUniformLocation(u,c[s]);e.programs[t]=u},makeTexture:function(e,t){var r,n;r=e.gl,n=r.createTexture(),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t.img),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.generateMipmap(r.TEXTURE_2D),n.textrue=t,e.textures[t]=n,r.bindTexture(r.TEXTURE_2D,null)},makeFrameBuffer:function(t,r,n){var a,i,o,u,s,l,c,h;n&&(l=n.width,c=n.height,h=e.devicePixelRatio,s=r.renderArea?r.renderArea:[0,0,l,c],a=t.gl,o=a.createFramebuffer(),o.x=s[0],o.y=s[1],o.width=Math.min(s[2]*h,l),o.height=Math.min(s[3]*h,c),a.bindFramebuffer(a.FRAMEBUFFER,o),i=a.createTexture(),a.bindTexture(a.TEXTURE_2D,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,o.width,o.height,0,a.RGBA,a.UNSIGNED_BYTE,null),u=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,u),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,o.width,o.height),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,u),a.bindTexture(a.TEXTURE_2D,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),t.framebuffers[r]={frameBuffer:o,texture:i})},vertexShaderParser:function(e){var t,r,n,a,i;for(i=e.code,a={uniforms:[],attributes:[],id:i.id,shaderStr:null},n="",r=i.attributes,t=r.length;t--;)n+="attribute "+r[t]+";\n",a.attributes.push(r[t].split(" ")[1]);for(r=i.uniforms,t=r.length;t--;)n+="uniform "+r[t]+";\n",a.uniforms.push(r[t].split(" ")[1]);for(r=i.varyings,t=r.length;t--;)n+="varying "+r[t]+";\n";return n+=C.baseFunction,n+="void main(void){\n",n+=i.main+";\n",n+="}\n",a.shaderStr=n,a},fragmentShaderParser:function(e){var t,r,n,a,i;for(i=e.code,a={uniforms:[],id:i.id,shaderStr:null},n="",n+=i.precision?"precision "+i.precision+";\n":"precision mediump float;\n",r=i.uniforms,t=r.length;t--;)n+="uniform "+r[t]+";\n",a.uniforms.push(r[t].split(" ")[1]);for(r=i.varyings,t=r.length;t--;)n+="varying "+r[t]+";\n";return n+="void main(void){\n",n+=i.main+";\n",n+="}\n",a.shaderStr=n,a}}}(),P=function(){var e,t,r,n,a,i,o,u,l,c,h,m,d;return o={},i=function(e){var t;if(e=Function.prototype.toString.call(e),e=e.substring(e.indexOf("(")+1,e.indexOf(")")).trim().split(","),t=e.length,t){for(;t--;)e[t]=e[t].trim();return e}},e=function(e,t,r,n){if(n!==o)throw new Error("Defineder는 extend를 통해서만 사용할 수 있습니다");this.parent=r,this._construct="function"==typeof t?{name:e,description:"Constructor of "+e,param:i(t),value:t}:{name:e,description:t.description,param:t.param,ret:t.ret,sample:t.sample,value:t.value},this._info={_method:{},_static:{},_field:{},_constant:{},_event:{}},this._method={},this._static={},this._field={},this._constant={},this._event={},Object.freeze(this)},t=function(){var t,r,n,a,i,s,f,v,g,p,x,b,S,F,A,E;return x=0,b={},S={},A=0,F={},E={},v={factory:1},g={superChain:1},s={},f={writable:!0},n=[],p={extend:{value:function(t){var r;return 1==arguments.length?(r=t,t=t.name):r=arguments[1],new e(t,r,this,o)}},getInstance:{value:function(e){var t,r,n;if(e in b){if(t=b[e],t.classId==this.uuid)return t}else{r=S[this.uuid];for(n in r)if(r[n]==e)return b[n]}this.error("getInstance",0)}},count:{value:function(){return F[this.uuid]}},error:{value:function(e,t){throw new Error(this.className+"."+e+":"+t)}}},t=function(e,t){return function(){var a;if(!this.isAlive)throw new Error("Destroyed Object:"+this);return n[n.length]=r,r=e,a=t.apply(this,arguments),r=n.pop(),a}},a=function(e,r,n){var a,i;for(a in r)r.hasOwnProperty(a)&&(i=r[a],n?e[a]=i.value:(i.value=t(a,i.value),Object.defineProperty(e,a,i)))},i=function(e,r,n){var a,i;for(a in r)r.hasOwnProperty(a)&&(i=r[a],n||(i.get&&(i.get=t(a+"Get",i.get)),i.set&&(i.set=t(a+"Set",i.set))),Object.defineProperty(e,a,i))},l={get:function(){return S[this.classId]&&this.uuid in S[this.classId]?S[this.classId][this]:null},set:function(e){if(S[this.classId]){if(e in S[this.classId].ref)throw new Error(this.className+".idSetter:0")}else S[this.classId]={ref:{}};null===e&&this.uuid in S[this.classId]?(e=S[this.classId][this],delete S[this.classId][this],delete S[this.classId].ref[e]):(S[this.classId][this]=e,S[this.classId].ref[e]=this.uuid)}},c=function(){var e;for(e in this)this.hasOwnProperty(e)&&(this[e]=null);S[this.classId]&&this.uuid in S[this.classId]&&(e=S[this.classId][this],delete S[this.classId][this],delete S[this.classId].ref[e]),delete b[this],this.isAlive=!1,F[this.classId]--,A--},h=function(e){var t;e||(e={});for(t in E)E.hasOwnProperty(t)&&(e[t]=E[t].cls);return e},m=function(){return A},d=function(e){throw new Error(this.className+"."+r+":"+e)},u=function(){s.value="uuid:"+x++,Object.defineProperty(this,"uuid",s),b[this]=this,f.value=!0,Object.defineProperty(this,"isAlive",f),F[this.classId]++,A++},function(){var e,t,o,u,l;t=this.parent,o=this._construct.value,e=function(){var a,i,u=arguments[0];return n[n.length]=r,r="constructor",u===g?(t&&t.call(this,g,arguments[1]),o.apply(this,arguments[1])):this instanceof e?(a=u===v?arguments[1]:arguments,t&&(t.call(this,g,a),o.apply(this,a),Object.seal(this),i=this)):i=e.call(Object.create(e.prototype),v,arguments),r=n.pop(),i},E[this._construct.value.name]={cls:e,define:this},u=t?Object.create(t.prototype):e.prototype,s.value=e.uuid="uuid:"+x++,Object.defineProperty(u,"classId",s),s.value=e.className=this._construct.value.name,Object.defineProperty(u,"className",s),e.uuid in F||(F[e.uuid]=0);for(l in p)this["static"](l,p[l]);return i(u,this._field),a(u,this._method),i(e,this._constant,!0),i(e,this._event,!0),a(e,this._static,!0),e.prototype=u,Object.freeze(e),t&&Object.freeze(u),e}}(),r=function(e){return{value:function(t,r,n){return"function"==typeof r?n||(this[e][t]={value:r},this._info[e][t]={description:("_static"==e?"Static method":"Method")+" of "+this._construct.value.name,param:i(r),ret:"?"}):(n||(this[e][t]={value:r.value}),this._info[e][t]={description:r.description,param:r.param||(n?"":i(r.value)),ret:r.ret,sample:r.sample,exception:r.exception}),this}}},n="configurable,enumerable,writable,get,set,value".split(","),a=function(e){return{value:function(t,r,a){var i,o;if(r&&"object"==typeof r){if(!a)for(this[e][t]=i={},o=n.length;o--;)n[o]in r&&(i[n[o]]=r[n[o]]);this._info[e][t]={type:r.type,description:r.description||("_constant"==e?"Const":"_event"==e?"Event":"Field")+" of "+this._construct.value.name,defaultValue:r.defaultValue,sample:r.sample,exception:r.exception}}else void 0===r?(i={},this[e][t]={get:function(){return i[this.uuid]},set:function(e){i[this.uuid]=e}}):this[e][t]={value:t},this._info[e][t]={description:("_constant"==e?"Const":"_event"==e?"Event":"Field")+" of "+this._construct.value.name};return!a&&"value"in this[e][t]&&(this._info[e][t].value=this[e][t].value),this}}},Object.defineProperties(e.prototype,{method:r("_method"),"static":r("_static"),field:a("_field"),constant:a("_constant"),event:a("_event"),build:{value:t}}),Object.freeze(e),Object.freeze(e.prototype),u=function(){var t,r,n;return n={},r={},t=new e("MoGL",{value:u},null,o).field("id",l).field("isUpdated",{get:function(){return r[this]||!1},set:function(e){this.dispatch("updated",r[this]=e)}}).field("uuid",{},!0).field("className",{},!0).field("classId",{},!0).method("error",{},!0).method("toString",{},!0).method("destroy",{value:c}).method("setId",{value:function(e){return this.id=e,this}}).method("setProperties",{value:function(){var e,t,r,n=0;return t=function a(e){var t,n,i,o,s,l,c;for(t in r)if(i=r[t],e>i.start)if(o=i.target,l=i.init,s=i.prop,e>i.end)if(i.repeat>1)i.repeat--,i.start=e,i.end=e+i.term,i.yoyo&&(i.init=s,i.prop=l);else{for(n in s)o[n]=s[n];delete r[t],o.dispatch(u.propertyChanged)}else{var h=i.ease,c=(e-i.start)/i.term;for(n in s)o[n]=h(c,l[n],s[n]-l[n])}requestAnimationFrame(a)},r={},function(a,i){var o,l;if(i){r[n++]=l={ease:i.ease||(s?s.linear:function(){}),repeat:i.repeat||0,yoyo:i.yoyo||!1,target:this,prop:a,init:{},start:performance.now()+("delay"in i?1e3*i.delay:0),term:1e3*i.time},l.end=l.start+l.term;for(o in a)l.init[o]=this[o];e||(e=!0,requestAnimationFrame(t))}else{for(o in a)this[o]=a[o];this.dispatch(u.propertyChanged)}}}()}).method("addEventListener",{value:function(e,t){var r;return n[this]||(n[this]={}),r=n[this],r[e]||(r[e]=[]),r=r[e],r[r.length]={f:t,cx:arguments[2]||this,arg:arguments.length>3?Array.prototype.slice.call(arguments,3):null},this}}).method("removeEventListener",{value:function(e,t){var r,a;if(t){if(n[this]&&n[this][e])for(r=n[this][e],a=r.length;a--;)("string"==typeof t&&r[a].f.name==t||r[a].f===t)&&r.splice(a,1)}else n[this]&&n[this][e]&&delete n[this][e];return this}}).method("dispatch",{value:function(e){var t,r,a,i,o;if(n[this]&&n[this][e])for(arguments.length>1&&(r=Array.prototype.slice.call(arguments,1)),t=n[this][e],a=0,i=t.length;i>a;a++)o=t[a],r?o.arg?o.f.apply(o.cx,r.concat(o.arg)):o.f.apply(o.cx,r):o.arg?o.f.apply(o.cx,o.arg):o.f.call(o.cx);return this}})["static"]("classes",{value:h})["static"]("totalCount",{value:m}).event("updated",{value:"updated"}).event("propertyChanged",{value:"propertyChanged"}).constant("ease",{value:s}),t.build()}(),function(){var e=u.prototype;e.error=d,e.toString=function(){return this.uuid},Object.freeze(e)}(),u}(),R=P.extend("Vector",{value:function(e,t,r){e instanceof Float32Array||Array.isArray(e)?(this.x=e[0],this.y=e[1],this.z=e[2]):void 0==e?this.x=this.y=this.z=0:(this.x=e,this.y=t,this.z=r)}}).method("add",{value:function(e){var t=this;return t.x+=e.x,t.y+=e.y,t.z+=e.z,this}}).method("addXYZ",{value:function(e,t,r){var n=this;return n.x+=e||0,n.y+=t||0,n.z+=r||0,this}}).method("subtract",{value:function(e){var t=this;return t.x-=e.x,t.y-=e.y,t.z-=e.z,this}}).method("subtractXYZ",{value:function(e,t,r){var n=this;return n.x-=e||0,n.y-=t||0,n.z-=r||0,this}}).method("scaleBy",{value:function(e){var t=this;return t.x*=e,t.y*=e,t.z*=e,this}}).method("distance",{value:function(e){var t=this,r=e.x-t.x,n=e.y-t.y,a=e.z-t.z;return g(r*r+n*n+a*a)}}).method("negate",{value:function(){var e=this;return e.x=-e.x,e.y=-e.y,e.z=-e.z,this}}).method("normalize",{value:function(){var e=this,t=e.x,r=e.y,n=e.z,a=t*t+r*r+n*n;return a>0&&(a=1/g(a),e.x*=a,e.y*=a,e.z*=a),this}}).method("dot",{value:function(e){var t=this;return t.x*e.x+t.y*e.y+t.z*e.z}}).method("cross",{value:function(e){var t=this,r=new Float32Array([0,0,0]),n=t.x,a=t.y,i=t.z,o=e.x,u=e.y,s=e.z;return r.x=a*s-i*u,r.y=i*o-n*s,r.z=n*u-a*o,new R(r.x,r.y,r.z)}}).build(),_={anaglyph:"anaglyph",bevel:"bevel",bloom:"bloom",blur:"blur",colorMatrix:"colorMatrix",convolution:"convolution",displacementMap:"displacementMap",fxaa:"fxaa",glow:"glow",invert:"invert",mono:"mono",sepia:"sepia",shadow:"shadow"};Object.freeze(_);var M=P.extend("Vertex",{value:function(){}}).constant("x",{value:"x"}).constant("y",{value:"y"}).constant("z",{value:"z"}).constant("r",{value:"r"}).constant("g",{value:"g"}).constant("b",{value:"b"}).constant("a",{value:"a"}).constant("normalX",{value:"normalX"}).constant("normalY",{value:"normalY"}).constant("normalZ",{value:"normalZ"}).constant("u",{value:"u"}).constant("v",{value:"v"}).build(),T=(P.extend("BlendMode",{value:function(){}}).constant("add",{value:"add"}).constant("alpha",{value:"alpha"}).constant("darken",{value:"darken"}).constant("difference",{value:"difference"}).constant("erase",{value:"erase"}).constant("hardlight",{value:"hardlight"}).constant("invert",{value:"invert"}).constant("lighten",{value:"lighten"}).constant("multiply",{value:"multiply"}).constant("screen",{value:"screen"}).constant("subtract",{value:"subtract"}).build(),function(){return P.extend("Primitive",{value:function(){}})["static"]("plane",{value:function(e,t){var r,n,a,i,o,u,s,l,c=arguments[0]||1,h=arguments[1]||1;(0==e||0==t)&&this.error(0),u=c+1,s=0,l=0,r=[],n=[];for(var m=0;h>=m;++m)for(var d=0;c>=d;++d)a=d/c-.5,i=m/h-.5,r[s++]=a,r[s++]=0,r[s++]=i,r[s++]=d/c,r[s++]=m/h,d!=c&&m!=h&&(o=d+m*u,n[l++]=o,n[l++]=o+u,n[l++]=o+u+1,n[l++]=o,n[l++]=o+u+1,n[l++]=o+1);var f=new U(r,n,[M.x,M.y,M.z,M.u,M.v]);return f}})["static"]("polygon",{value:function(e){e=arguments[0]||3,3>e&&this.error(0);var t,r,n,a,i,o,u,s,l=2*b/e,m=[0,1,0,.5,0],d=[],f=m.length;for(t=0;e-1>t;t=t/f+1)n=m[t*=f]*h(l)-m[++t]*c(l),a=m[--t]*c(l)+m[++t]*h(l),i=m[--t+2],o=.5+n/1/2,u=.5-a/1/2,m.push(n,a,i,o,u),t>0&&(r=t/f,d.push(0,r,r+1));return s=new U(m,d,[M.x,M.y,M.z,M.u,M.v])}})["static"]("cube",{value:function(e,t,r){var n,a,i,o,u,s,l,c,h,m,d,f,v,g,p,x,b,S,F,A,E,y,P,R,_,T,C,w,V,D,L=0;for(n=arguments[0]||1,a=arguments[1]||1,i=arguments[2]||1,o=[],u=[],f=0,v=0,g=.5,p=.5,x=.5,b=1/n,S=1/a,F=1/i,E=1,y=1,P=0,R=0,_=P,T=R,C=2*P,w=0,V=E/n,D=y/a,0==i&&this.error(0),m=0;n>=m;m++)for(A=-g+m*b,d=0;a>=d;d++)o[f++]=A,o[f++]=-p+d*S,o[f++]=-x,o[f++]=1-(_+m*V),o[f++]=T+(y-d*D),o[f++]=A,o[f++]=-p+d*S,o[f++]=x,o[f++]=1-(C+(E-m*V)),o[f++]=w+(y-d*D),m&&d&&(s=2*((m-1)*(a+1)+(d-1)),l=2*(m*(a+1)+(d-1)),c=s+2,h=l+2,u[v++]=s,u[v++]=c,u[v++]=h,u[v++]=s,u[v++]=h,u[v++]=l,u[v++]=l+1,u[v++]=h+1,u[v++]=c+1,u[v++]=l+1,u[v++]=c+1,u[v++]=s+1);for(L+=2*(n+1)*(a+1),_=P,T=0,C=0,w=0,V=E/n,D=y/i,m=0;n>=m;m++)for(A=-g+m*b,d=0;i>=d;d++)o[f++]=A,o[f++]=p,o[f++]=-x+d*F,o[f++]=1-(_+m*V),o[f++]=T+(y-d*D),o[f++]=A,o[f++]=-p,o[f++]=-x+d*F,o[f++]=1-(C+m*V),o[f++]=w+d*D,m&&d&&(s=L+2*((m-1)*(i+1)+(d-1)),l=L+2*(m*(i+1)+(d-1)),c=s+2,h=l+2,u[v++]=s,u[v++]=c,u[v++]=h,u[v++]=s,u[v++]=h,u[v++]=l,u[v++]=l+1,u[v++]=h+1,u[v++]=c+1,u[v++]=l+1,u[v++]=c+1,u[v++]=s+1);for(L+=2*(n+1)*(i+1),_=0,T=R,C=2*P,w=R,V=E/i,D=y/a,m=0;i>=m;m++)for(A=x-m*F,d=0;a>=d;d++)o[f++]=-g,o[f++]=-p+d*S,o[f++]=A,o[f++]=1-(_+m*V),o[f++]=T+(y-d*D),o[f++]=g,o[f++]=-p+d*S,o[f++]=A,o[f++]=1-(C+(E-m*V)),o[f++]=w+(y-d*D),m&&d&&(s=L+2*((m-1)*(a+1)+(d-1)),l=L+2*(m*(a+1)+(d-1)),c=s+2,h=l+2,u[v++]=s,u[v++]=c,u[v++]=h,u[v++]=s,u[v++]=h,u[v++]=l,u[v++]=l+1,u[v++]=h+1,u[v++]=c+1,u[v++]=l+1,u[v++]=c+1,u[v++]=s+1);var N=new U(o,u,[M.x,M.y,M.z,M.u,M.v]);return N}})["static"]("sphere",{value:function(e,t){var r=[],n=[],a=e,i=t,o=1;(0==e||0==t)&&this.error(0);for(var u=0;a>=u;++u)for(var s=u*b/a,l=c(s),m=h(s),d=0;i>=d;++d){var f=2*d*b/i,v=c(f),g=h(f),p=g*l,x=m,S=v*l,F=1-d/i,A=1-u/a;r.push(o*p,o*x,o*S,F,A)}for(u=0;a>u;++u)for(d=0;i>d;++d){var E=u*(i+1)+d,y=E+i+1;n.push(y,E,E+1,y+1,y,E+1)}var P=new U(r,n,[M.x,M.y,M.z,M.u,M.v]);return P}})["static"]("geodesic",{value:function(){var e,t,r,n,a,i,o,u,s,l,m,d,f,v,g,p=.5,x=arguments[0]||30,E=!0,y=x,P=2*y,R=180/P*A,_=[],T=[];for(o=0,u=0,s=-p,E?_.push(o,-s,u,0,0):_.push(o,u,s,0,0),a=0;y>a;a++)for(e=4*(a+1),n=360/e*A,r=-S+(a+1)*R,g=(S+r)/b,l=c(r),m=h(r),s=p*l,i=0;e>=i;i++)t=i*n,d=c(t),f=h(t),o=p*m*f,u=p*m*d,v=1-t/F,E?_.push(o,-s,u,v,g):_.push(o,u,s,v,g);for(a=1;y>a;a++)for(e=4*(y-a),n=360/e*A,r=R*a,g=(S+r)/b,l=c(r),m=h(r),s=p*l,i=0;e>=i;i++)t=i*n,d=c(t),f=h(t),o=p*m*f,u=p*m*d,v=1-t/F,E?_.push(o,-s,u,v,g):_.push(o,u,s,v,g);o=0,u=0,s=p,E?_.push(o,-s,u,v,g):_.push(o,u,s,v,g);var C,w,V,D,L,N,B,z,X,I,O,G,Y;for(G=1,L=0,N=0,a=0;y>a;++a){for(z=L,X=N,L+=4*a+1,N+=4*(a+1)+1,I=z,B=L,C=0;4>C;++C)for(O=1,Y=0;G>Y;++Y)1===O?(w=I,D=B,B++,V=B,O=0):(w=B,V=I,I++,D=I,O=1),T.push(w,V,D);G+=2}for(a=y-1;a>=0;a--)for(z=L,X=N,L=L+4*(a+1)+1,N=N+4*a+1,G-=2,B=L,I=z,C=0;4>C;++C)for(O=0,Y=0;G>Y;Y++)1===O?(w=I,D=B,B++,V=B,O=0):(w=B,V=I,I++,D=I,O=1),T.push(w,V,D);var k=new U(_,T,[M.x,M.y,M.z,M.u,M.v]);return k}})["static"]("skybox",{value:function(e,t,r){(0==e||0==t||0==r)&&this.error(0)}}).build()}(),P.extend("Shading",{value:function(){}}).constant("none",{value:"none"}).constant("gouraud",{value:"gouraud"}).constant("phong",{value:"phong"}).constant("blinn",{value:"blinn"}).constant("flat",{value:"flat"}).constant("toon",{value:"toon"}).build()),C={baseFunction:"mat4 positionMTX(vec3 t){\n   return mat4( 1,0,0,0, 0,1,0,0, 0,0,1,0, t[0],t[1],t[2],1);\n}\nmat4 scaleMTX(vec3 t){\n   return mat4( t[0],0,0,0, 0,t[1],0,0, 0,0,t[2],0, 0,0,0,1);\n}\nmat4 rotationMTX(vec3 t){\n   float s = sin(t[0]);float c = cos(t[0]);\n   mat4 m1 = mat4( 1,0,0,0, 0,c,s,0, 0,-s,c,0, 0,0,0,1);s = sin(t[1]);c = cos(t[1]);\n   mat4 m2 = mat4(c,0,-s,0, 0,1,0,0, s,0,c,0,  0,0,0,1);s = sin(t[2]);c = cos(t[2]);\n   mat4 m3 = mat4(c,s,0,0, -s,c,0,0, 0,0,1,0,  0,0,0,1);\n   return m3*m2*m1;\n}\n"};Object.freeze(C);var w=function(){var e;return e={},t("Shader",{}),P.extend("Shader",{value:function(t){e[this]=t}}).field("code",{get:i(e)}).constant("colorVertexShader",{get:function(){var e;return function(){return e||(e=new w({id:"colorVertexShader",attributes:["vec3 aVertexPosition"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec4 uColor"],varyings:["vec4 vColor"],"function":[C.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvColor = uColor;"]}))}}()}).constant("colorFragmentShader",{get:function(){var e;return function(){return e||(e=new w({id:"colorFragmentShader",precision:"mediump float",uniforms:[],varyings:["vec4 vColor"],"function":[],main:["gl_FragColor =  vColor"]}))}}()}).constant("wireFrameVertexShader",{get:function(){var e;return function(){return e||(e=new w({id:"wireFrameVertexShader",attributes:["vec3 aVertexPosition"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec4 uColor"],varyings:["vec4 vColor"],"function":[C.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvColor = uColor ;"]}))}}()}).constant("wireFrameFragmentShader",{get:function(){var e;return function(){return e||(e=new w({id:"wireFrameFragmentShader",precision:"mediump float",uniforms:[],varyings:["vec4 vColor"],"function":[],main:["gl_FragColor =  vColor;"]}))}}()}).constant("bitmapVertexShader",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapVertexShader",attributes:["vec3 aVertexPosition","vec2 aUV"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV"],"function":[C.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvUV = aUV;"]}))}}()}).constant("bitmapFragmentShader",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapFragmentShader",precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec2 vUV"],"function":[],main:["gl_FragColor =  texture2D(uSampler, vec2(vUV.s, vUV.t))"]}))}}()}).constant("colorVertexShaderGouraud",{get:function(){var e;return function(){return e||(e=new w({id:"colorVertexShaderGouraud",attributes:["vec3 aVertexPosition","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uDLite","float uLambert","vec3 uRotate","vec3 uScale","vec3 uPosition","vec4 uColor"],varyings:["vec4 vColor"],"function":[C.baseFunction],main:[" mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\n gl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\n vec3 N = (mv * vec4(aVertexNormal, 0.0)).xyz;\n vec3 LD = normalize(vec4(uDLite, 0.0)).xyz;\n float df = max(0.1,dot(N,-LD)*uLambert);\n vColor = uColor*df; vColor[3] = uColor[3];"]}))}}()}).constant("colorFragmentShaderGouraud",{get:function(){var e;return function(){return e||(e=new w({id:"colorFragmentShaderGouraud",precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec4 vColor"],"function":[],main:["gl_FragColor =  vColor;\n"]}))}}()}).constant("bitmapVertexShaderGouraud",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapVertexShaderGouraud",attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uDLite","float uLambert","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV","vec4 vLight"],"function":[C.baseFunction],main:[" mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\n gl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\n vec3 N = (mv * vec4(aVertexNormal, 0.0)).xyz;\n vec3 LD = normalize(vec4(uDLite, 0.0)).xyz;\n float df = max(0.1,dot(N,-LD)*uLambert);\n vLight = vec4(1.0,1.0,1.0,1.0)*df;\n vLight[3] = 1.0;\n vUV = aUV;"]}))}}()}).constant("bitmapFragmentShaderGouraud",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapFragmentShaderGouraud",precision:"mediump float",uniforms:["sampler2D uSampler"],varyings:["vec2 vUV","vec4 vLight"],"function":[],main:["gl_FragColor =  (vLight*texture2D(uSampler, vec2(vUV.s, vUV.t)));\ngl_FragColor.a = 1.0;"]}))}}()}).constant("colorVertexShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"colorVertexShaderPhong",attributes:["vec3 aVertexPosition","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec4 uColor"],varyings:["vec3 vNormal","vec3 vPosition","vec4 vColor"],"function":[C.baseFunction],main:["mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = vec3(mv * vec4(-aVertexNormal, 0.0));\nvColor = uColor;"]}))}}()}).constant("colorFragmentShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"colorFragmentShaderPhong",precision:"mediump float",uniforms:["float uLambert","vec3 uDLite"],varyings:["vec3 vNormal","vec3 vPosition","vec4 vColor"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = uDLite;\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.1)*uLambert;\nfloat specular = 0.0;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\n   specular = pow(specAngle, 4.0);\n}\ngl_FragColor = vColor*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = vColor[3];"]}))}}()}).constant("toonVertexShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"toonVertexShaderPhong",attributes:["vec3 aVertexPosition","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition","vec4 uColor"],varyings:["vec3 vNormal","vec3 vPosition","vec4 vColor"],"function":[C.baseFunction],main:["mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = (vec3( mv * vec4(-aVertexNormal, 0.0)));\nvColor = uColor;"]}))}}()}).constant("toonFragmentShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"toonFragmentShaderPhong",precision:"mediump float",uniforms:["float uLambert","vec3 uDLite"],varyings:["vec3 vNormal","vec3 vPosition","vec4 vColor"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = uDLite;\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.1)*uLambert;\nfloat specular = 0.0;\nvec3 src = vColor.rgb;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.0);\n   specular = pow(specAngle, 4.0);\n}\nsrc = src*(ambientColor +lambertian*diffuseColor +specular*specColor);\n if(lambertian>0.95-0.5) src.rgb*=0.95;\n else if(lambertian>0.4-0.5) src.rgb*=0.5;\n else if(lambertian>0.3-0.5) src.rgb*=0.3;\n else src.rgb*=0.1;\ngl_FragColor.rgb = src.rgb;\ngl_FragColor.a = vColor[3];"]}))}}()}).constant("bitmapVertexShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapVertexShaderPhong",attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[C.baseFunction],main:["mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = (vec3( mv * vec4(-aVertexNormal, 0.0)));\nvUV = aUV;"]}))}}()}).constant("bitmapFragmentShaderPhong",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapFragmentShaderPhong",precision:"mediump float",uniforms:["sampler2D uSampler","float uLambert","vec3 uDLite"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = uDLite;\nvec3 reflectDir = reflect(lightDir, normal);\nvec3 viewDir = normalize(-vPosition);\nfloat lambertian = max(dot(lightDir,normal), 0.1)*uLambert;\nfloat specular = 0.0;\nif(lambertian > 0.0) {\nfloat specAngle = max(dot(reflectDir, viewDir), 0.1);\n   specular = pow(specAngle, 4.0)*uLambert;\n}\ngl_FragColor = texture2D(uSampler, vec2(vUV.s, vUV.t))*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = 1.0;"]}))}}()}).constant("bitmapVertexShaderBlinn",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapVertexShaderBlinn",attributes:["vec3 aVertexPosition","vec2 aUV","vec3 aVertexNormal"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[C.baseFunction],main:["mat4 mv = uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale);\ngl_Position = uPixelMatrix*mv*vec4(aVertexPosition, 1.0);\nvPosition = vec3(mv * vec4(aVertexPosition, 1.0));\nvNormal = vec3( mv * vec4(-aVertexNormal, 0.0));\nvUV = aUV;"]}))}}()}).constant("bitmapFragmentShaderBlinn",{get:function(){var e;return function(){return e||(e=new w({id:"bitmapFragmentShaderBlinn",precision:"mediump float",uniforms:["sampler2D uSampler","float uLambert","vec3 uDLite"],varyings:["vec2 vUV","vec3 vNormal","vec3 vPosition"],"function":[],main:["vec3 ambientColor = vec3(0.0, 0.0, 0.0);\nvec3 diffuseColor = vec3(1.0, 1.0, 1.0);\nvec3 specColor = vec3(1.0, 1.0, 1.0);\nvec3 normal = normalize(vNormal);\nvec3 lightDir = uDLite;\nfloat lambertian = max(dot(lightDir,normal), 0.1)*uLambert;\nfloat specular = 0.0;\nvec3 viewDir = normalize(vPosition);\nif(lambertian > 0.0) {\n	vec3 halfDir = normalize(lightDir + viewDir);\n	float specAngle = max(dot(halfDir, normal), 0.0);\n	specular = pow(specAngle, 16.0);\n}\ngl_FragColor = texture2D(uSampler, vec2(vUV.s, vUV.t))*vec4(ambientColor +lambertian*diffuseColor +specular*specColor, 1.0);\ngl_FragColor.a = 1.0;"]}))}}()}).constant("postBaseVertexShader",{get:function(){var e;return function(){return e||(e=new w({id:"postBaseVertexShader",attributes:["vec3 aVertexPosition","vec2 aUV"],uniforms:["mat4 uPixelMatrix","mat4 uCameraMatrix","vec3 uRotate","vec3 uScale","vec3 uPosition"],
varyings:["vec2 vUV"],"function":[C.baseFunction],main:["gl_Position = uPixelMatrix*uCameraMatrix*positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0);\nvUV = aUV;"]}))}}()}).constant("postBaseFragmentShader",{get:function(){var e;return function(){return e||(e=new w({id:"postBaseFragmentShader",precision:"mediump float",uniforms:["sampler2D uSampler","vec2 uTexelSize","int uFXAA"],varyings:["vec2 vUV"],"function":[],main:["if(uFXAA==1){\nfloat FXAA_REDUCE_MIN = (1.0/128.0);\nfloat FXAA_REDUCE_MUL = (1.0/8.0);\nfloat FXAA_SPAN_MAX = 8.0;\nvec4 rgbNW = texture2D(uSampler, (vUV + vec2(-1.0, -1.0) * uTexelSize));\nvec4 rgbNE = texture2D(uSampler, (vUV + vec2(1.0, -1.0) * uTexelSize));\nvec4 rgbSW = texture2D(uSampler, (vUV + vec2(-1.0, 1.0) * uTexelSize));\nvec4 rgbSE = texture2D(uSampler, (vUV + vec2(1.0, 1.0) * uTexelSize));\nvec4 rgbM = texture2D(uSampler, vUV);\nvec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM = dot(rgbM, luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),FXAA_REDUCE_MIN);\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * uTexelSize;\nvec4 rgbA = 0.5 * (	texture2D(uSampler, vUV + dir * (1.0 / 3.0 - 0.5))+	texture2D(uSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\nvec4 rgbB = rgbA * 0.5 + 0.25 * (texture2D(uSampler, vUV + dir *  -0.5)+texture2D(uSampler, vUV + dir * 0.5));\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\n	gl_FragColor = rgbA;\n}\nelse {\n	gl_FragColor = rgbB;\n}\n}else{\n	gl_FragColor =  texture2D(uSampler, vec2(vUV.s, vUV.t));}"]}))}}()}).build()}(),V=function(){var e,t,r,n;return n={},e=new Float32Array(16),t=function(e,t,r){return function(n){n?"0"in n?(this[e]=n[0],this[t]=n[1],this[r]=n[2]):e in arg&&(this[e]=n[e],this[t]=n[t],this[r]=n[r]):this[e]=this[t]=this[r]=0}},r=function(e,t,r){var n=new Float32Array(3);return function(a){return n[0]=this[e],n[1]=this[t],n[2]=this[r],n}},P.extend("Matrix",{value:function(){n[this]=new Float32Array(16),this.matIdentity(),this.x=this.y=this.z=this.rotateX=this.rotateY=this.rotateZ=0,this.scaleX=this.scaleY=this.scaleZ=1}}).field("position",{set:t("x","y","z"),get:r("x","y","z")}).field("scale",{set:t("scaleX","scaleY","scaleZ"),get:r("scaleX","scaleY","scaleZ")}).field("rotate",{set:t("rotateX","rotateY","rotateZ"),get:r("rotateX","rotateY","rotateZ")}).field("matrix",{get:function(){return this instanceof B?this.matIdentity().matScale(this.scaleX,this.scaleY,this.scaleZ).matRotateX(this.rotateX).matRotateY(this.rotateY).matRotateZ(this.rotateZ).matTranslate(this.x,this.y,-this.z):this.matIdentity().matScale(this.scaleX,this.scaleY,this.scaleZ).matRotateX(this.rotateX).matRotateY(this.rotateY).matRotateZ(this.rotateZ).matTranslate(this.x,this.y,this.z),this}}).field("raw",{get:function(){return n[this]}}).method("lookAt",{value:function(){var e=new Float32Array(3),t=new Float32Array(3);return function(r,a,i){var o,u,s,l,c,m,d,g,p,x,b,F,A,E,y;this.matIdentity(),e[0]=this.x,e[1]=this.y,e[2]=this.z,t[0]=r,t[1]=a,t[2]=i,this.matLookAt(e,t,[0,1,0]),o=n[this],u=o[0],s=o[1],l=o[2],c=o[4],m=o[5],d=o[6],g=o[8],p=o[9],x=o[10],b=-g,A=-1>=b?-S:b>=1?S:v(b),y=h(A),.001>=y?(E=0,F=f(-d,m)):(E=f(c,u),F=f(p,x)),this.rotateX=F,this.rotateY=A,this.rotateZ=E}}()}).method("matIdentity",{value:function(){var e=n[this];return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}}).method("matClone",{value:function(){var e,t,r;return e=n[this],r=new V,t=n[r],t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],r}}).method("matCopy",{value:function(e){var t=n[this];return e=n[e],e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}}).method("matMultiply",{value:function(e){var t=n[this];e=n[e];var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],l=t[6],c=t[7],h=t[8],m=t[9],d=t[10],f=t[11],v=t[12],g=t[13],p=t[14],x=t[15],b=e[0],S=e[1],F=e[2],A=e[3];return t[0]=r*b+u*S+h*F+v*A,t[1]=a*b+s*S+m*F+g*A,t[2]=i*b+l*S+d*F+p*A,t[3]=o*b+c*S+f*F+x*A,b=e[4],S=e[5],F=e[6],A=e[7],t[4]=r*b+u*S+h*F+v*A,t[5]=a*b+s*S+m*F+g*A,t[6]=i*b+l*S+d*F+p*A,t[7]=o*b+c*S+f*F+x*A,b=e[8],S=e[9],F=e[10],A=e[11],t[8]=r*b+u*S+h*F+v*A,t[9]=a*b+s*S+m*F+g*A,t[10]=i*b+l*S+d*F+p*A,t[11]=o*b+c*S+f*F+x*A,b=e[12],S=e[13],F=e[14],A=e[15],t[12]=r*b+u*S+h*F+v*A,t[13]=a*b+s*S+m*F+g*A,t[14]=i*b+l*S+d*F+p*A,t[15]=o*b+c*S+f*F+x*A,this}}).method("matTranslate",{value:function(e,t,r){var a=n[this];return a[12]=a[0]*e+a[4]*t+a[8]*r+a[12],a[13]=a[1]*e+a[5]*t+a[9]*r+a[13],a[14]=a[2]*e+a[6]*t+a[10]*r+a[14],a[15]=a[3]*e+a[7]*t+a[11]*r+a[15],this}}).method("matScale",{value:function(e,t,r){var a=n[this];return a[0]=a[0]*e,a[1]=a[1]*e,a[2]=a[2]*e,a[3]=a[3]*e,a[4]=a[4]*t,a[5]=a[5]*t,a[6]=a[6]*t,a[7]=a[7]*t,a[8]=a[8]*r,a[9]=a[9]*r,a[10]=a[10]*r,a[11]=a[11]*r,a[12]=a[12],a[13]=a[13],a[14]=a[14],a[15]=a[15],this}}).method("matRotateX",{value:function(e){var t=n[this],r=c(e),a=h(e),i=t[4],o=t[5],u=t[6],s=t[7],l=t[8],m=t[9],d=t[10],f=t[11];return t[4]=i*a+l*r,t[5]=o*a+m*r,t[6]=u*a+d*r,t[7]=s*a+f*r,t[8]=l*a-i*r,t[9]=m*a-o*r,t[10]=d*a-u*r,t[11]=f*a-s*r,this}}).method("matRotateY",{value:function(e){var t=n[this],r=c(e),a=h(e),i=t[0],o=t[1],u=t[2],s=t[3],l=t[8],m=t[9],d=t[10],f=t[11];return t[0]=i*a-l*r,t[1]=o*a-m*r,t[2]=u*a-d*r,t[3]=s*a-f*r,t[8]=i*r+l*a,t[9]=o*r+m*a,t[10]=u*r+d*a,t[11]=s*r+f*a,this}}).method("matRotateZ",{value:function(e){var t=n[this],r=c(e),a=h(e),i=t[0],o=t[1],u=t[2],s=t[3],l=t[4],m=t[5],d=t[6],f=t[7];return t[0]=i*a+l*r,t[1]=o*a+m*r,t[2]=u*a+d*r,t[3]=s*a+f*r,t[4]=l*a-i*r,t[5]=m*a-o*r,t[6]=d*a-u*r,t[7]=f*a-s*r,this}}).method("matRotate",{value:function(e,t){var r,a,i,o,u,s,m,d,f,v,p,b,S,F,A,E,y,P,R,_,M,T,C,w,V=n[this],D=t[0],U=t[1],L=t[2],N=g(D*D+U*U+L*L);return x(N)<l?null:(N=1/N,D*=N,U*=N,L*=N,r=c(e),a=h(e),i=1-a,o=V[0],u=V[1],s=V[2],m=V[3],d=V[4],f=V[5],v=V[6],p=V[7],b=V[8],S=V[9],F=V[10],A=V[11],E=D*D*i+a,y=U*D*i+L*r,P=L*D*i-U*r,R=D*U*i-L*r,_=U*U*i+a,M=L*U*i+D*r,T=D*L*i+U*r,C=U*L*i-D*r,w=L*L*i+a,V[0]=o*E+d*y+b*P,V[1]=u*E+f*y+S*P,V[2]=s*E+v*y+F*P,V[3]=m*E+p*y+A*P,V[4]=o*R+d*_+b*M,V[5]=u*R+f*_+S*M,V[6]=s*R+v*_+F*M,V[7]=m*R+p*_+A*M,V[8]=o*T+d*C+b*w,V[9]=u*T+f*C+S*w,V[10]=s*T+v*C+F*w,V[11]=m*T+p*C+A*w,V!==V&&(V[12]=V[12],V[13]=V[13],V[14]=V[14],V[15]=V[15]),this)}}).method("_frustum",function(e,t,r,a,i,o){var u=n[this],s=t-e,l=a-r,c=o-i;return u[0]=2*i/s,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=2*i/l,u[6]=0,u[7]=0,u[8]=(t+e)/s,u[9]=(a+r)/l,u[10]=-(o+i)/c,u[11]=-1,u[12]=0,u[13]=0,u[14]=-(o*i*2)/c,u[15]=0,this}).method("matPerspective",{value:function(e,t,r,n){return e=r*Math.tan(e*Math.PI/360),t=e*t,this._frustum(-t,t,-e,e,r,n),this}}).method("matLookAt",{value:function(e,t,r){var a,i,o,u,s,c,h,m,d,f,v=n[this],p=e[0],b=e[1],S=e[2],F=r[0],A=r[1],E=r[2],y=t[0],P=t[1],R=t[2];return x(p-y)<l&&x(b-P)<l&&x(S-R)<l?this.matIdentity():(h=p-y,m=b-P,d=S-R,f=1/g(h*h+m*m+d*d),h*=f,m*=f,d*=f,a=A*d-E*m,i=E*h-F*d,o=F*m-A*h,f=g(a*a+i*i+o*o),f?(f=1/f,a*=f,i*=f,o*=f):(a=0,i=0,o=0),u=m*o-d*i,s=d*a-h*o,c=h*i-m*a,f=g(u*u+s*s+c*c),f?(f=1/f,u*=f,s*=f,c*=f):(u=0,s=0,c=0),v[0]=a,v[1]=u,v[2]=h,v[3]=0,v[4]=i,v[5]=s,v[6]=m,v[7]=0,v[8]=o,v[9]=c,v[10]=d,v[11]=0,v[12]=-(a*p+i*b+o*S),v[13]=-(u*p+s*b+c*S),v[14]=-(h*p+m*b+d*S),v[15]=1,this)}}).method("matStr",{value:function(){var e=n[this];return"Matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}}).build()}(),D=function(){var e,r,n,a,o,u,s,l,c;return u={},s={},c={},t("Texture",{imgs:s}),e={".jpg":1,".png":1,".gif":1},r=document.createElement("canvas"),n=r.getContext("2d"),r.width=r.height=2,n.clearRect(0,0,2,2),a=document.createElement("img"),a.src=r.toDataURL(),o=function(e,t){var a,i,o,u;for(a=i=1;t.width>a;)a*=2;for(;t.height>i;)i*=2;switch(t.width==a&&t.height==i,e==D.zoomOut&&(t.width<a&&(a/=2),t.height<i&&(i/=2)),r.width=o=a,r.height=u=i,n.clearRect(0,0,a,i),e){case D.crop:t.width<a&&(o=a/2),t.height<i&&(u=i/2),n.drawImage(t,0,0,a,i,0,0,o,u);break;case D.addSpace:n.drawImage(t,0,0,a,i,0,0,a,i);break;default:n.drawImage(t,0,0,o,u)}return t.src=r.toDataURL(),t},l=function(e){var t=D.getInstance(this.dataset.texture);c[t]=!0,s[t]=o(t.resizeType,this),this.removeEventListener("load",l),t.dispatch("load")},P.extend("Texture",{value:function(){}}).field("resizeType",{get:i(u,!1,"zoomOut"),set:function(e){D[e]?u[this]=e:this.error(0)}}).field("isLoaded",{get:i(c,!1,!1)}).field("img",{get:i(s,!1,a),set:function(t){var a,i,u,h;a=!1,i=document.createElement("img"),t instanceof HTMLImageElement?(i.src=t.src,i.complete&&(a=!0)):t instanceof ImageData?(a=!0,r.width=u=t.width,r.height=h=t.height,n.clearRect(0,0,u,h),n.putImageData(t,0,0),i.src=n.toDataURL()):"string"==typeof t?("data:image"==t.substring(0,10)&&t.indexOf("base64")>-1?a=!0:e[t.substring(-4)]||this.error(1),i.src=t):this.error(0),a?(c[this]=!0,i.dataset.cls=D,i.dataset.texture=this.uuid,s[this]=o(this.resizeType,i),this.dispatch("load")):(i.dataset.cls=D,i.dataset.texture=this.uuid,i.addEventListener("load",l))}}).event("load",{value:"load"}).constant("zoomOut",{value:"zoomOut"}).constant("zoomIn",{value:"zoomIn"}).constant("crop",{value:"crop"}).constant("addSpace",{value:"addSpace"}).constant("diffuse",{value:"diffuse"}).constant("specular",{value:"specular"}).constant("diffuseWrap",{value:"diffuseWrap"}).constant("normal",{value:"normal"}).constant("specularNormal",{value:"specularNormal"}).build()}(),U=function(){var e,r,n,a,o,u,s,l,c;return e={},o={},s={},l={},u={},r={},n={},a={},c={},t("Geometry",{}),P.extend("Geometry",{value:function(){var t,a,i,c,h,m;return t=function(){var e,t,r;return e=Math.sqrt,t={x:0,y:0,z:0},r={x:0,y:0,z:0},function(n,a,i){var o,u,s,l;for(n.length=0,o=0,u=a.length;u>o;o++)n[o]=0;for(o=0,u=i.length;u>o;o+=3)for(s=3*i[o+1],l=3*i[o],t.x=a[s]-a[l],t.y=a[s+1]-a[l+1],t.z=a[s+2]-a[l+2],l=3*i[o+2],r.x=a[l]-a[s],r.y=a[l+1]-a[s+1],r.z=a[l+2]-a[s+2],s=0;3>s;s++)l=3*i[o+s],n[l]+=t.y*r.z-t.z*r.y,n[l+1]+=t.z*r.x-t.x*r.z,n[l+2]+=t.x*r.y-t.y*r.x;for(o=0,u=a.length;u>o;o+=3)t.x=n[o],t.y=n[o+1],t.z=n[o+2],s=e(t.x*t.x+t.y*t.y+t.z*t.z)||1e-5,n[o]=t.x/s,n[o+1]=t.y/s,n[o+2]=t.z/s;return n}}(),a=function(e){return M[e]},i=[],c=[],h=[],m=[],function(d,f,v){var g,p,x,b,S,F,A;if(Array.isArray(d)||d instanceof Float32Array?Array.isArray(f)||f instanceof Uint16Array||this.error(1):this.error(0),i.length=c.length=h.length=m.length=0,v){for(Array.isArray(v)?v.some(a)||this.error(4):this.error(3),g=v.length,d.length%g&&this.error(2),p=g;p--;)v[v[p]]=p;for(S=v.normalX&&v.normalY&&v.normalZ,F=v.u&&v.v,A=v.r&&v.g&&v.b&&v.a,p=0,x=d.length/g;x>p;p++)b=g*p,i.push(d[b+v.x],d[b+v.y],d[b+v.z]),S&&c.push(d[b+v.normalX],d[b+v.normalY],d[b+v.normalZ]),F&&h.push(d[b+v.u],d[b+v.v]),A&&m.push(d[b+v.r],d[b+v.g],d[b+v.b],d[b+v.a]);e[this]=new Float32Array(i)}else g=3,e[this]=d instanceof Float32Array?d:new Float32Array(d);S||t(c,v?i:d,f),o[this]=new Float32Array(c),r[this]=d.length/g,n[this]=f.length/3,s[this]=new Float32Array(h),l[this]=new Float32Array(m),u[this]=f instanceof Uint16Array?f:new Uint16Array(f)}}()}).field("vertexCount",{get:i(r)}).field("triangleCount",{get:i(n)}).field("volume",{get:function(){var t,r,n,a,i,o,u,s,l,h,m;if(!c[this]){for(t=r=n=a=i=o=0,h=e[this],m=h.length;m--;)u=3*m,s=u+1,l=u+2,t=h[u]<t?h[u]:t,a=h[u]>a?h[u]:a,r=h[s]<r?h[s]:r,i=h[s]>i?h[s]:i,n=h[l]<n?h[l]:n,o=h[l]>o?h[l]:o;c[this]=[a-t,i-r,o-n]}return c[this]}}).field("position",{get:i(e)}).field("normal",{get:i(o)}).field("uv",{get:i(s)}).field("color",{get:i(l)}).field("index",{get:i(u)}).build()}(),L=function(){var e,r,n,a,s,l,c,h,m,d,f,v,g;return h={},m={},n={},a={},s={},l={},c={},d={},f={},v={},g={},t("Material",{color:g,wireFrame:d,wireFrameColor:f,shading:h,lambert:m,diffuse:n}),e=function(t){this.removeEventListener(D.load,e),t.dispatch(L.changed),t.isLoaded&&t.dispatch(L.load)},r={diffuse:n,specular:s,diffuseWrap:l,normal:a,specularNormal:c},P.extend("Material",{value:function(){g[this]=[1,1,1,1],arguments.length&&(this.color=arguments.length>1?arguments:arguments[0]),f[this]=[Math.random(),Math.random(),Math.random(),1],d[this]=!1,m[this]=1,h[this]=T.none}}).field("count",{get:i(v,!1,0)}).field("color",{get:i(g),set:function(e){var t=g[this];e=u(e),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}}).field("wireFrame",{get:i(d),set:o(d)}).field("wireFrameColor",{get:i(f),set:function(e){var t=f[this];e=u(e),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}}).field("shading",{get:i(h),set:o(h)}).field("lambert",{get:i(m),set:o(m)}).field("diffuse",{get:i(n)}).field("isLoaded",{get:function(e){var t,n,a;for(t in r)if(n=r[t][e])for(a=n.length;a--;)if(!n[a].tex.isLoaded)return!1;return!0}}).method("addTexture",{value:function(t,n){var a,i=arguments[2];return r[t]||this.error(0),n instanceof D||this.error(1),a=r[t],this in a?(a=a[this],a[n]&&this.error(2)):a=a[this]=[],a[n]=1,n.isLoaded||n.addEventListener(D.load,e,null,this),n={tex:n},arguments.length>3&&(n.blendMode=arguments[3]),void 0===i||null===i?a[a.length]=n:"number"==typeof i?0>i||i>a.length-1?this.error(4):a.splice(i,0,n):i instanceof D?(i=a.indexOf(i),i>-1?a.splice(i,0,n):this.error(5)):this.error(3),this.dispatch(L.changed),this.isLoaded&&this.dispatch(L.load),this}}).method("removeTexture",{value:function(e,t){var n,a,i;if(r[e])n=r[e][this],n[t]&&(n[t]=0,i=n.length,n.splice(n.indexOf(t),1),delete n[t]);else for(a in r)n=r[a][this],n[t]&&(n[t]=0,n.splice(n.indexOf(t),1),delete n[t]);return this.dispatch(L.changed),this}}).event("changed","changed").build()}(),N=function(){var e,r,n;return e={},r={},n={},t("Mesh",{geometry:e,material:r,culling:n}),V.extend("Mesh",{value:function(e,t){this.geometry=e,this.material=t}}).field("culling",{get:i(n,!1,"cullingNone"),set:function(e){N[e]?n[this]=e:this.error(0)}}).field("geometry",{get:i(e),set:function(t){t instanceof U?(e[this]=t,this.dispatch("changed")):this.error(0)}}).field("material",{get:i(r),set:function(e){e instanceof L?(r[this]=e,this.dispatch("changed")):this.error(0)}}).constant("cullingNone",{value:"cullingNone"}).constant("cullingFront",{value:"cullingFront"}).constant("cullingBack",{value:"cullingBack"}).event("changed","changed").build()}(),B=(V.extend(function(){}).method("addChild",function(e){return this}).method("getChild",function(e){return null}).method("removeChild",function(e){return this}).build(),function(){var e,r;return e=.5*A,r={},t("Camera",{}),V.extend("Camera",{value:function n(){Object.seal(r[this]={r:0,g:0,b:0,a:1,fov:55,near:.1,far:1e4,fog:!1,fogColor:null,fogNear:0,fogFar:0,visible:!0,antialias:!1,mode:n.perspective,renderArea:null,projectionMatrix:V()}),this.z=10,this.lookAt(0,0,0)}}).field("clipPlaneNear",{get:i(r,"near"),set:o(r,"near")}).field("clipPlaneFar",{get:i(r,"far"),set:o(r,"far")}).field("visible",{get:i(r,"visible"),set:function(e){"number"==typeof e&&(e=e?!0:!1),r[this].visible=e}}).field("antialias",{get:i(r,"antialias"),set:function(e){"number"==typeof e&&(e=e?!0:!1),r[this].antialias=e}}).field("fogColor",{get:i(r,"fogColor"),set:function(e){var t=r[this];t.fogColor=u(e).slice(0),t.fog=!0}}).field("fogNear",{get:i(r,"fogNear"),set:function(e){var t=r[this];t.fogNear=e,t.fog=!0}}).field("fogFar",{get:i(r,"fogFar"),set:function(e){var t=r[this];t.fogFar=e,t.fog=!0}}).field("fov",{get:i(r,"fov"),set:function(t){var n=r[this];"number"==typeof t?n.fov=t:"0"in t&&"1"in t&&(n.fov=p(2*d(m(t[2]*e)*(t[1]/t[0]))*E))}}).field("backgroundColor",{get:function(){var e=[];return function(){var t=r[this];return e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a,e}}(),set:function(e){var t=r[this];e=u(e),t.r=e[0],t.g=e[1],t.b=e[2],t.a=e[3]}}).field("fog",{get:function(){return r[this].fog?!0:!1}}).field("mode",{get:i(r,"mode"),set:function(e){B[e]?r[this].mode=e:this.error(0)}}).field("renderArea",{get:i(r,"renderArea"),set:function(e){r[this].renderArea=e}}).field("projectionMatrix",{get:function(){return r[this].projectionMatrix}}).method("resetProjectionMatrix",{value:function(){var e,t,n;return n=r[this],e=n.projectionMatrix,t=n.renderArea,e.matIdentity(),"2d"==this._mode?(e.raw[0]=2/t[2],e.raw[5]=-2/t[3],e.raw[10]=0,e.raw[12]=-1,e.raw[13]=1):e.matPerspective(n.fov,t[2]/t[3],n.near,n.far),this}}).constant("resize","resize").constant("othogonal","othogonal").constant("perspective","perspective").build()}()),z=function(){var e,r,n,a,u,s,l,c,h,m,d,f;return n={},a={},u={},f={},s={},l={},c={},h={},m={},d={},t("Scene",{children:n,childrenArray:a}),e=y.vertexShaderParser,r=y.fragmentShaderParser,P.extend("Scene",{value:function(){n[this]={},a[this]=[],u[this]={},s[this]={},l[this]={},c[this]={},h[this]={},m[this]={},d[this]={mesh:[],material:[],camera:[]},f[this]=[0,-1,-1],this.addVertexShader(w.colorVertexShader),this.addFragmentShader(w.colorFragmentShader),this.addVertexShader(w.wireFrameVertexShader),this.addFragmentShader(w.wireFrameFragmentShader),this.addVertexShader(w.bitmapVertexShader),this.addFragmentShader(w.bitmapFragmentShader),this.addVertexShader(w.bitmapVertexShaderGouraud),this.addFragmentShader(w.bitmapFragmentShaderGouraud),this.addVertexShader(w.colorVertexShaderGouraud),this.addFragmentShader(w.colorFragmentShaderGouraud),this.addVertexShader(w.colorVertexShaderPhong),this.addFragmentShader(w.colorFragmentShaderPhong),this.addVertexShader(w.toonVertexShaderPhong),this.addFragmentShader(w.toonFragmentShaderPhong),this.addVertexShader(w.bitmapVertexShaderPhong),this.addFragmentShader(w.bitmapFragmentShaderPhong),this.addVertexShader(w.bitmapVertexShaderBlinn),this.addFragmentShader(w.bitmapFragmentShaderBlinn),this.addVertexShader(w.postBaseVertexShader),this.addFragmentShader(w.postBaseFragmentShader)}}).field("updateList",{get:i(d)}).field("vertexShaders",{get:i(h)}).field("fragmentShaders",{get:i(m)}).field("baseLightRotate",{set:o(f),get:i(f)}).field("cameras",{get:i(u)}).field("children",{get:i(n)}).method("addMesh",{value:function(e){var t,r=n[this],i=d[this];return r[e]&&this.error(0),e instanceof N||this.error(1),r[e]=e,i.mesh.push(e),t=e.material,t.addEventListener(L.load,function(){var e=this.diffuse;if(e)for(var t=e.length;t--;)-1==i.material.indexOf(e[t].tex)&&i.material.push(e[t].tex)}),e.addEventListener(N.changed,function(){i.mesh.push(e)}),t.dispatch(L.load,t),-1==a[this].indexOf(e)&&a[this].push(e),this}}).method("addCamera",{value:function(e){var t=u[this];return t[e]&&this.error(0),e instanceof B||this.error(1),t[e]=e,d[this].camera.push(e),this}}).method("addChild",{value:function(e){return e instanceof N?this.addMesh(e):e instanceof B?this.addCamera(e):this.error(0),this}}).method("addGeometry",{value:function(e){var t=c[this];return t[e]&&this.error(0),e instanceof U||this.error(1),t[e]=e,this}}).method("addMaterial",{value:function(e){var t=l[this];return t[e]&&this.error(0),e instanceof L||this.error(1),t[e]=e,this}}).method("addTexture",{value:function(e){var t=s[this];return t[e]&&this.error(0),e instanceof D||this.error(1),t[e]=e,this}}).method("addFragmentShader",function(e){var t=m[this];return t[e.code.id]&&this.error(0),t[e.code.id]=r(e),this}).method("addVertexShader",function(t){var r=h[this];return r[t.code.id]&&this.error(0),r[t.code.id]=e(t),this}).method("getMesh",{value:function(e){var t,r=n[this];for(t in r)if(r[t].id==e)return r[t];return null}}).method("getCamera",{value:function(e){var t,r=u[this];for(t in r)if(r[t].id==e)return r[t];return null}}).method("getChild",{value:function(e){var t;return(t=this.getMesh(e))?t:(t=this.getCamera(e))?t:null}}).method("getGeometry",{value:function(e){var t,r=c[this];for(t in r)if(r[t].id==e)return r[t];return null}}).method("getMaterial",{value:function(e){var t,r=l[this];for(t in r)if(r[t].id==e)return r[t];return null}}).method("getTexture",{value:function(e){var t,r=s[this];for(t in r)if(r[t].id==e)return r[t];return null}}).method("removeChild",{value:function(e){var t,r,i;t=n[this],i=!1;for(r in t)t[r].id==e&&(a[this].splice(a[this].indexOf(t[r]),1),delete t[r],i=!0);return i}}).method("removeGeometry",{value:function(e){var t,r,n;t=c[this],n=!1;for(r in t)t[r].id==e&&(delete t[r],n=!0);return n}}).method("removeMaterial",{value:function(e){var t,r,n;t=l[this],n=!1;for(r in t)t[r].id==e&&(delete t[r],n=!0);return n}}).method("removeTexture",{value:function(e){var t,r;return t=s[this],r=!1,t[e]&&(delete t[e],r=!0),r}}).build()}(),X=function(t){var n,a,i,o,u,s,l,c,h,m,d,f,v,g=V();a={alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1},n=function(e){var t,r,n;if(i)t=e.getContext(i,a);else for(r="experimental-webgl,webgl,webkit-3d,moz-webgl,3d".split(","),n=r.length;n--;)if(t=e.getContext(r[n],a)){i=r[n];break}return t};var p={},x=[],b={},S={},F={},A={};return o=t.makeVBO,u=t.makeVNBO,s=t.makeIBO,l=t.makeUVBO,c=t.makeProgram,h=t.makeTexture,m=t.makeFrameBuffer,d=function(e){o(e,"null",[0,0,0],3),e.vbo._FRAMERECT_||(o(e,"_FRAMERECT_",[-1,1,0,1,1,0,-1,-1,0,1,-1,0],3),l(e,"_FRAMERECT_",[0,0,1,0,0,1,1,1],2),s(e,"_FRAMERECT_",[0,1,2,1,2,3],1))},f=function(e,t){var r,n;r=t.vertexShaders,n=t.fragmentShaders,c(e,"color",r.colorVertexShader,n.colorFragmentShader),c(e,"wireFrame",r.wireFrameVertexShader,n.wireFrameFragmentShader),c(e,"bitmap",r.bitmapVertexShader,n.bitmapFragmentShader),c(e,"bitmapGouraud",r.bitmapVertexShaderGouraud,n.bitmapFragmentShaderGouraud),c(e,"colorGouraud",r.colorVertexShaderGouraud,n.colorFragmentShaderGouraud),c(e,"colorPhong",r.colorVertexShaderPhong,n.colorFragmentShaderPhong),c(e,"toonPhong",r.toonVertexShaderPhong,n.toonFragmentShaderPhong),c(e,"bitmapPhong",r.bitmapVertexShaderPhong,n.bitmapFragmentShaderPhong),c(e,"bitmapBlinn",r.bitmapVertexShaderBlinn,n.bitmapFragmentShaderBlinn),c(e,"postBase",r.postBaseVertexShader,n.postBaseFragmentShader)},v=function(t){var r,n,a,i;r=x[t];for(a in r){n=r[a].cameras;for(i in n){var o,u,s,l;if(o=n[i],s=b[t],u=o.renderArea,l=e.devicePixelRatio,u&&!o.renderArea.byAutoArea){var c,h;c=s.width,h=s.height;var d=u[2]/c,f=u[3]/h;u=["string"==typeof u[0]?c*u[0].replace("%","")*.01:u[0],"string"==typeof u[1]?h*u[1].replace("%","")*.01:u[1],"string"==typeof u[2]?c*u[2].replace("%","")*.01:u[2],"string"==typeof u[3]?h*u[3].replace("%","")*.01:u[3]],o.renderArea=[u[0],u[1],c*d,h*f],o.renderArea.byAutoArea=!1}else o.renderArea=[0,0,s.width,s.height],o.renderArea.byAutoArea=!0;o.resetProjectionMatrix(),m(A[t],o,s)}}},P.extend("World",{value:function(e){e||this.error(0),b[this]=document.getElementById(e),A[this]={gl:null,vbo:{},vnbo:{},uvbo:{},ibo:{},programs:{},textures:{},framebuffers:{}},b[this]||this.error(1),(A[this].gl=n(b[this]))?(p[this]={},x[this]=[],S[this]=null):this.error(2)}}).method("setAutoSize",{value:function(t){var r,n,a;return t?(this._autoSizer||(a=this,r=b[this],n=x[this],S[this]=function(){var n,i,o;n=e.innerWidth,i=e.innerHeight,o=e.devicePixelRatio,r.width=n*o,r.height=i*o,r.style.width=n+"px",r.style.height=i+"px",r._autoSize=t,v(a)}),e.addEventListener("resize",S[this]),e.addEventListener("orientationchange",S[this]),S[this]()):S[this]&&(e.removeEventListener("resize",S[this]),e.removeEventListener("orientationchange",S[this])),this}}).method("addScene",{value:function(e){var t,r;for(t=x[this],r=t.length,e instanceof z||this.error(1),console.log(t);r--;)t[r]==e&&this.error(0);t.push(e);var n=A[this];return d(n),f(n,e),v(this),this}}).method("getScene",{value:function(e){var t,r;if(r=x[this],t=r.length,"undefined"==typeof e)return null;for(;t--;)if(r[t].id==e)return r[t];return null}}).method("getRenderer",{value:function(e){var t,r;return t=p[this],t||(t={}),r=this,e?t[1]?t[1]:t[1]=function(e){r.render(e),F[r.uuid]=requestAnimationFrame(t[1])}:t[0]?t[0]:(t[0]=function(e){r.render(e)},t[0])}}).method("start",{value:function(){var e=this.getRenderer(1);return F[this.uuid]=requestAnimationFrame(e),this}}).method("stop",{value:function(){return cancelAnimationFrame(F[this.uuid]),this}}).method("removeScene",{value:function(e){var t,r;if(r=x[this],t=r.length,"undefined"==typeof e)return null;for(;t--;)if(r[t].id==e)return r.splice(t,1),console.log(x),this;this.error("0")}}).method("render",{value:function(){{var t,n,a,i,c,m,d,f,p,S,F,E,y,P,R,_,M,C,w,V,D,U,L,B,z,I,O,G,Y,k,j,W,Z,H,q,Q,K,J,$,ee,te,re,ne,ae,ie,oe,ue,se,le,ce,he,me=0,de=new Float32Array(3);new Float32Array(4)}return q=r("Scene","children"),Q=r("Scene","childrenArray"),K=r("Mesh","geometry"),J=r("Mesh","material"),$=r("Mesh","culling"),ee=r("Material","color"),te=r("Material","wireFrame"),re=r("Material","wireFrameColor"),ne=r("Material","shading"),ae=r("Material","lambert"),ie=r("Material","diffuse"),function(r){for(me=0,O=null,G=null,Y=null,k=null,j=null,W=null,Z=null,y=b[this.uuid],m=x[this.uuid],p=A[this.uuid],S=p.gl,P=y.width,R=y.height,t=m.length,this.dispatch(X.renderBefore,r);t--;){for(c=m[t],a=c.updateList.mesh.length;a--;){var fe,ve;fe=c.updateList.mesh[a],ve=fe.geometry,ve&&(p.vbo[ve]||(o(p,ve,ve.position,3),u(p,ve,ve.normal,3),l(p,ve,ve.uv,2),s(p,ve,ve.index,1)))}for(a=c.updateList.material.length;a--;)h(p,c.updateList.material[a]);c.updateList.camera.length&&v(this),c.updateList.mesh.length=0,c.updateList.material.length=0,c.updateList.camera.length=0,d=c.cameras,se=c.baseLightRotate;for(i in d)me++;for(i in d)if(f=d[i],f.visible){me>1?(z=p.framebuffers[f.uuid].frameBuffer,S.bindFramebuffer(S.FRAMEBUFFER,z),S.viewport(0,0,z.width,z.height)):S.viewport(0,0,P,R),F=q[c.uuid],E=Q[c.uuid],S.enable(S.DEPTH_TEST),S.depthFunc(S.LESS),S.enable(S.BLEND),S.blendFunc(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA),he=f.backgroundColor,S.clearColor(he[0],he[1],he[2],he[3]),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT);var ge=f.projectionMatrix.raw,pe=f.matrix.raw;for(i in p.programs)C=p.programs[i],S.useProgram(C),S.uniformMatrix4fv(C.uPixelMatrix,!1,ge),S.uniformMatrix4fv(C.uCameraMatrix,!1,pe),C.uDLite&&S.uniform3fv(C.uDLite,se);for(_=M=C=V=L=null,n=E.length;n--;){switch(_=E[n],ue=_.uuid,oe=K[ue].uuid,V=p.vbo[oe],D=p.vnbo[oe],U=p.uvbo[oe],L=p.ibo[oe],M=J[ue],w=$[ue],w!=G&&(w==N.cullingNone?S.disable(S.CULL_FACE):w==N.cullingBack?(S.enable(S.CULL_FACE),S.frontFace(S.CCW)):w==N.cullingFront&&(S.enable(S.CULL_FACE),S.frontFace(S.CW))),le=0,ce=0,H=M.uuid,I=ne[H],ie[H]&&(ce=1),I){case T.none:C=ce?p.programs.bitmap:p.programs.color;break;case T.gouraud:C=ce?p.programs.bitmapGouraud:p.programs.colorGouraud,le=1;break;case T.toon:C=p.programs.toonPhong,le=1;break;case T.phong:C=ce?p.programs.bitmapPhong:p.programs.colorPhong,le=1;break;case T.blinn:C=p.programs.bitmapBlinn,le=1}if(O!=C&&(O=null,Y=null,k=null,j=null,W=null,S.useProgram(C)),V!=Y&&(S.bindBuffer(S.ARRAY_BUFFER,V),S.vertexAttribPointer(C.aVertexPosition,V.stride,S.FLOAT,!1,0,0)),he=ee[H],S.uniform4fv(C.uColor,he),le&&(D!=k&&(S.bindBuffer(S.ARRAY_BUFFER,D),S.vertexAttribPointer(C.aVertexNormal,D.stride,S.FLOAT,!1,0,0)),S.uniform1f(C.uLambert,ae[H])),ce){U!=j&&(S.bindBuffer(S.ARRAY_BUFFER,U),S.vertexAttribPointer(C.aUV,U.stride,S.FLOAT,!1,0,0));var xe=ie[H];xe.length&&(B=p.textures[xe[xe.length-1].tex.uuid],B!=Z&&S.bindTexture(S.TEXTURE_2D,B),S.uniform1i(C.uSampler,0))}de[0]=_.rotateX,de[1]=_.rotateY,de[2]=_.rotateZ,S.uniform3fv(C.uRotate,de),de[0]=_.x,de[1]=_.y,de[2]=_.z,S.uniform3fv(C.uPosition,de),de[0]=_.scaleX,de[1]=_.scaleY,de[2]=_.scaleZ,S.uniform3fv(C.uScale,de),L!=W?S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,L):0,S.drawElements(S.TRIANGLES,L.numItem,S.UNSIGNED_SHORT,0),te[H]&&(S.enable(S.DEPTH_TEST),S.depthFunc(S.LEQUAL),C=p.programs.wireFrame,S.useProgram(C),V!=Y?S.bindBuffer(S.ARRAY_BUFFER,V):0,V!=Y?S.vertexAttribPointer(C.aVertexPosition,V.stride,S.FLOAT,!1,0,0):0,de[0]=_.rotateX,de[1]=_.rotateY,de[2]=_.rotateZ,S.uniform3fv(C.uRotate,de),de[0]=_.x,de[1]=_.y,de[2]=_.z,S.uniform3fv(C.uPosition,de),de[0]=_.scaleX,de[1]=_.scaleY,de[2]=_.scaleZ,S.uniform3fv(C.uScale,de),he=re[H],S.uniform4fv(C.uColor,he),S.drawElements(S.LINES,L.numItem,S.UNSIGNED_SHORT,0),S.enable(S.DEPTH_TEST),S.depthFunc(S.LESS)),O=C,G=w,Y=V,k=D,j=U,W=L,Z=B}me>1&&(S.bindFramebuffer(S.FRAMEBUFFER,null),O=null,Y=null,k=null,j=null,W=null)}}if(me>1){if(S.viewport(0,0,y.width,y.height),S.clearColor(0,0,0,1),S.enable(S.DEPTH_TEST),S.depthFunc(S.LEQUAL),S.enable(S.BLEND),S.blendFunc(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT),V=p.vbo._FRAMERECT_,U=p.uvbo._FRAMERECT_,L=p.ibo._FRAMERECT_,C=p.programs.postBase,!V)return;S.useProgram(C),S.uniformMatrix4fv(C.uPixelMatrix,!1,[2/y.clientWidth,0,0,0,0,-2/y.clientHeight,0,0,0,0,0,0,-1,1,0,1]),S.bindBuffer(S.ARRAY_BUFFER,V),S.vertexAttribPointer(C.aVertexPosition,V.stride,S.FLOAT,!1,0,0),S.bindBuffer(S.ARRAY_BUFFER,U),S.vertexAttribPointer(C.aUV,U.stride,S.FLOAT,!1,0,0),S.uniform3fv(C.uRotate,[0,0,0]),S.uniformMatrix4fv(C.uCameraMatrix,!1,g.raw);for(i in d)f=d[i],f.visible&&(z=p.framebuffers[f.uuid].frameBuffer,S.uniform1i(C.uFXAA,f.antialias),f.antialias&&(f.renderArea?S.uniform2fv(C.uTexelSize,[1/z.width,1/z.height]):S.uniform2fv(C.uTexelSize,[1/y.width,1/y.height])),de[0]=z.x+z.width/2/e.devicePixelRatio,de[1]=z.y+z.height/2/e.devicePixelRatio,de[2]=0,S.uniform3fv(C.uPosition,de),de[0]=z.width/2/e.devicePixelRatio,de[1]=z.height/2/e.devicePixelRatio,de[2]=1,S.uniform3fv(C.uScale,de),S.bindTexture(S.TEXTURE_2D,p.framebuffers[f.uuid].texture),S.uniform1i(C.uSampler,0),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,L),S.drawElements(S.TRIANGLES,L.numItem,S.UNSIGNED_SHORT,0))}this.dispatch(X.renderAfter,r)}}()}).constant("renderBefore","WORLD_RENDER_BEFORE").constant("renderAfter","WORLD_RENDER_AFTER").build()}(y);e.MoGL=P}(this),this.hasOwnProperty("exports")&&(exports.mogl=MoGL);