<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="../src/MoGL.js"></script>
    <script src="../src/Vertex.js"></script>
    <script src="../src/Matrix.js"></script>
    <script src="../src/Geometry.js"></script>
    <script src="../src/Material.js"></script>
    <script src="../src/Texture.js"></script>
    <script src="../src/Mesh.js"></script>
    <script src="../src/Group.js"></script>
    <script src="../src/Camera.js"></script>
    <script src="../src/Scene.js"></script>
    <script src="../src/World.js"></script>
</head>
<body>
<canvas id="firstTest" width="600" height="400"></canvas>
<script id="vshader" type="text/shader">
attribute vec3 aVertexPosition;
uniform vec3 uRotate;
mat4 positionMTX(vec3 t){
    return mat4( 1,0,0,0, 0,1,0,0, 0,0,1,0, t[0],t[1],t[2],1);
}

mat4 scaleMTX(vec3 t){
    return mat4( t[0],0,0,0, 0,t[1],0,0, 0,0,t[2],0, 0,0,0,1);
}
mat4 rotationMTX(vec3 t){
    float s = sin(t[0]);float c = cos(t[0]);
    mat4 m1=mat4(1,0,0,0,0,c,-s,0,0,s,c,0, 0,0,0,1);
    s=sin(t[1]);c=cos(t[1]);
    mat4 m2=mat4(c,0,s,0,0,1,0,0,-s,0,c,0, 0,0,0,1);
    s=sin(t[2]);c=cos(t[2]);
    mat4 m3=mat4(c,-s,0,0,s,c,0,0,0,0,1,0, 0,0,0,1);
    return m3 * m2 * m1;
}
void main(void){
    gl_Position = rotationMTX(uRotate)*vec4(aVertexPosition, 1.0);
}
</script>
<script id="fshader" type="text/shader">
precision mediump float;
void main(void) {
     gl_FragColor =  vec4(1.0,1.0,1.0, 1.0);
}
</script>
<script>
    // 모글에 전역적인 루프 시스템이 있것고..
    var renders = []
    var LOOP = {}
    setInterval(function(){
        for(var i=0; i<renders.length; i++) renders[i]._render()
        for(var k in LOOP){
            LOOP[k]()
        }
    },16)


    var w = new World('firstTest');
    w.addScene('s0', new Scene());

    w.getScene('s0').addVertexShader( 'base',  document.getElementById('vshader').text );
    w.getScene('s0').addFragmentShader( 'base',  document.getElementById('fshader').text );

    w.getScene('s0').addGeometry('tri', new Geometry([-1, 0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 2]));
    w.getScene('s0').addMaterial('white', new Material('#fff'));
    w.getScene('s0').addChild('tri', new Mesh('tri', new Material('#ff2244')));
    w.getScene('s0').addChild('camera1', new Camera());
    w.getScene('s0')._update = 1
//    w.getScene('s0').addChild('camera2', new Camera());
    w.addRender('s0', 'camera1');
//    w.addRender('s0', 'camera2');

    LOOP['test '] = function(){
        w.getScene('s0').getChild('tri').rotateZ +=0.1
        w.getScene('s0').getChild('camera1').setBackgroundColor('#ffdddf')
        w.getScene('s0').getChild('camera1')._r = Math.random()
        w.getScene('s0').getChild('camera1')._g = Math.random()
        w.getScene('s0').getChild('camera1')._b = Math.random()
    }

    renders.push(w)
</script>
</body>
</html>