<!DOCTYPE html>
<html lang="ko">
<head>
    <title>Monkey</title>
    <meta charset="utf-8"/>
    <meta property="og:image" content="http://shallaa.github.io/SoftEngine/og/1.jpg"/>
    <meta property="og:title" content="Monkey"/>
    <meta property="og:description" content="MoGL.js version"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,target-densitydpi=high-dpi "/>
    <style>
        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
        }

        .FPS {
            color: #FFF;
            left: 0px;
            top: 0px;
            position: absolute
        }
    </style>
    <script src="../src/MoGL.js"></script>
    <script src="../src/BlendMode.js"></script>
    <script src="../src/Filter.js"></script>
    <script src="../src/Vertex.js"></script>
    <script src="../src/Shading.js"></script>
    <script src="../src/VertexShaderFunctions.js"></script>
    <script src="../src/Shader.js"></script>
    <script src="../src/Matrix.js"></script>
    <script src="../src/Geometry.js"></script>
    <script src="../src/Material.js"></script>
    <script src="../src/Texture.js"></script>
    <script src="../src/Mesh.js"></script>
    <script src="../src/Group.js"></script>
    <script src="../src/Camera.js"></script>
    <script src="../src/Scene.js"></script>
    <script src="../src/World.js"></script>
</head>
<body>
<img src="monkey/Suzanne.jpg" id="testIMG2" style="position: absolute;top:0px;" width="128" height="128">
<canvas id="canvas"></canvas>
<div class="FPS">
    Current FPS: <span id="currentFPS"></span>
    Average FPS: <span id="averageFPS"></span>
</div>
<script>
    (function (W) {
        'use strict';

        var world = new World('canvas');
        var scene = new Scene();


        var divCurrentFPS = document.getElementById('currentFPS');
        var divAverageFPS = document.getElementById('averageFPS');
        var prevTime = 0;

        world.addScene(scene);

        var camera = new Camera()
        scene.addChild(camera);
        var material = new Material(Math.random(), Math.random(), Math.random(), 1)
        var material2 = new Material(1, 1, 1, 0.5)
        var material3 = new Material(1, 1, 1, 0.5)
        var material4 = new Material(1, 1, 1, 0.5)
        var material5 = new Material(1, 1, 1, 0.5)
        var material6 = new Material(1, 1, 1, 0.5)



//        scene.addTexture(texture, 'monkey/Suzanne.jpg');
        var texture = new Texture
        texture.img = document.getElementById('testIMG2')
//        scene.getMaterial(material').addTexture(Texture.diffuse,texture);
//        scene.getMaterial(material2').addTexture(Texture.diffuse,texture);
//        scene.getMaterial(material3').addTexture(Texture.diffuse,texture);
        material4.addTexture(Texture.diffuse, texture);
        material5.addTexture(Texture.diffuse, texture);
        material6.addTexture(Texture.diffuse, texture);


        var xmlhttp = new XMLHttpRequest();

        xmlhttp.open('GET', 'monkey/monkey.babylon', true);
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
                start(JSON.parse(xmlhttp.responseText));
            }
        };
        xmlhttp.send(null);

        function start(json) {
            var mesh = json.meshes[0];
            var vertices = mesh.vertices;
            var indices = mesh.indices;
            var uvCount = mesh.uvCount;
            var verticesStep = 1;

            switch (uvCount) {
                case 0:
                    verticesStep = 6;
                    break;
                case 1:
                    verticesStep = 8;
                    break;
                case 2:
                    verticesStep = 10;
                    break;
            }

            var verticesCount = vertices.length / verticesStep;
            var facesCount = indices.length / 3;
            var vertex = [];
            var index = [];
            var i = 0;
            var j;

            for (; i < verticesCount; i++) {
                j = i * verticesStep;

                vertex.push(vertices[j], vertices[j + 1], vertices[j + 2], vertices[j + 3], vertices[j + 4], vertices[j + 5]);

                if (uvCount > 0) {
                    vertex.push(vertices[j + 6], vertices[j + 7]);
                } else {
                    vertex.push(0, 0);
                }
            }

            for (i = 0; i < facesCount; i++) {
                j = i * 3;

                index.push(indices[j], indices[j + 1], indices[j + 2]);
            }

            var geo = new Geometry(vertex, index, [Vertex.x, Vertex.y, Vertex.z, Vertex.normalX, Vertex.normalY, Vertex.normalZ, Vertex.u, Vertex.v])
            scene.addGeometry(geo);

            var mesh = new Mesh(geo, material);
            mesh.z = -5
            mesh.x = -3
            mesh.y = -1
            scene.addChild(mesh);
            material.wireFrame = 1

            var mesh2 = new Mesh(geo, material2);

            mesh2.y = -1
            scene.addChild(mesh2);

            var mesh3 = new Mesh(geo, material3);
            mesh3.x = 3
            mesh3.y = -1
            scene.addChild(mesh3);
//            material3.shading = Shading.toon


            var mesh4 = new Mesh(geo, material4);

            mesh4.x = 3
            mesh4.y = 1
            scene.addChild(mesh4);
//            material4.shading = Shading.gouraud
            material4.lambert = 1.5

            var mesh5 = new Mesh(geo, material5);

            mesh5.x = 0
            mesh5.y = 1
            scene.addChild(mesh5);
            material5.shading = Shading.phong
            material5.lambert = 1.5

            var mesh6 = new Mesh(geo, material6);
            mesh6.x = -3
            mesh6.y = 1
            scene.addChild(mesh6);
//            material6.shading = Shading.blinn
            material6.lambert = 1.5


//            camera.antialias=1

            var sum = 0, count = 1;
            world.addEventListener(World.renderAfter, function () {

                mesh.rotateY -= 0.02;
                mesh2.rotateY -= 0.02;
                mesh3.rotateY -= 0.02;
                mesh4.rotateY -= 0.02;
                mesh5.rotateY -= 0.02;
                mesh6.rotateY -= 0.02;

            })

            world.start()
            world.setAutoSize(1)


        }
    })(this);
</script>
</body>
</html>