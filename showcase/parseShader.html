<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>MoGL Test Suite - drawTriangle By ParserShader</title>
    <script src="../src/$.js"></script>
    <script src="../src/MoGL.js"></script>
    <script src="../src/BlendMode.js"></script>
    <script src="../src/Filter.js"></script>
    <script src="../src/Primitive.js"></script>
    <script src="../src/Vertex.js"></script>
    <script src="../src/Shading.js"></script>
    <script src="../src/VertexShaderFunctions.js"></script>
    <script src="../src/Shader.js"></script>
    <script src="../src/Matrix.js"></script>
    <script src="../src/Texture.js"></script>
    <script src="../src/Geometry.js"></script>
    <script src="../src/Material.js"></script>
    <script src="../src/Mesh.js"></script>
    <script src="../src/Group.js"></script>
    <script src="../src/Camera.js"></script>
    <script src="../src/Scene.js"></script>
    <script src="../src/World.js"></script>
    <link rel="stylesheet" type="text/css" href="css.css"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,target-densitydpi=high-dpi "/>
    <style>
        html, body {
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }
    </style>
</head>
<body>
<canvas id="firstTest" width="1024" height="1024"></canvas>

<script>
    // 모글에 전역적인 루프 시스템이 있것고..

    var w = new World('firstTest');
    w.setAutoSize(1)
    var scene = new Scene()
    w.addScene(scene)
    scene.addGeometry(new Geometry([-1, 0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 2]).setId('tri'));
    scene.addGeometry(new Geometry([
        0.5, 0.5, 0.0, 0.0, 0.0,
        -0.5, 0.5, 0.0, 1.0, 0.0,
        0.5, -0.5, 0.0, 0.0, 1.0,
        -0.5, -0.5, 0.0, 1.0, 1.0
    ], [0, 1, 2, 1, 2, 3], [Vertex.x, Vertex.y, Vertex.z, Vertex.u, Vertex.v]).setId('rect'));
    scene.addMaterial(new Material('#fff').setId('white'));
    scene.addChild(new Mesh(scene.getGeometry('tri'), new Material('#ff2244')).setId('tri'));

    var bitmapMaterial = new Material(Math.random(), Math.random(), Math.random())
    //    scene.addTexture('bitmapTextureTest', '../src/ohno.png')
    //    bitmapMaterial.addTexture(Texture.diffuse, 'bitmapTextureTest')
    scene.addMaterial(bitmapMaterial.setId('bitmapMaterial'))

    var list = []
    for (var i = 0; i < 100; i++) {
        scene.addChild(new Mesh(scene.getGeometry('tri'), new Material(Math.random(), Math.random(), Math.random())).setId('tri' + i));
        var a = scene.getChild('tri' + i)
        a.x = Math.random() * 50 - 25
        a.y = Math.random() * 50 - 25
        a.z = Math.random() * 50 - 25
        a.rotateX = Math.random()
        a.rotateY = Math.random()
        a.rotateZ = Math.random()

        list.push(a)

    }
    for (var i = 0; i < 100; i++) {
        scene.addChild(new Mesh(scene.getGeometry('rect'), scene.getMaterial('bitmapMaterial')).setId('rect' + i));
        var a = scene.getChild('rect' + i)
        a.x = Math.random() * 50 - 25
        a.y = Math.random() * 50 - 25
        a.z = Math.random() * 50 - 25
        a.rotateX = Math.random()
        a.rotateY = Math.random()
        a.rotateZ = Math.random()

        list.push(a)
    }

    //    scene.addChild('rect', new Mesh('rect', 'bitmapMaterial'));
    scene.addChild(new Camera().setId('camera1'));
    scene.addChild(new Camera().setId('camera2'));
    scene.addChild(new Camera().setId('camera3'));

    scene.getChild('camera1').backgroundColor = '#333333'
    scene.getChild('camera2').backgroundColor = '#55dd33'
    scene.getChild('camera3').backgroundColor = '#aaee33'
    scene.getChild('camera2').renderArea = [512 - 128 - 10, 10, 256, 256]
    scene.getChild('camera3').renderArea = [10, 10, 128, 128]

    w.start()



    var t = 0
    var t2 = 0
    w.addEventListener(World.renderAfter, function () {
        for (var i = 0; i < list.length; i++) {
            var a = list[i]
            a.rotateX += 0.01
            a.rotateY += 0.02
            a.rotateZ += 0.03
        }
    })


</script>
</body>
</html>